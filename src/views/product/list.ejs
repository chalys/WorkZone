<!DOCTYPE html>
<html lang="es">
<!-- Head -->
<%- include("../partials/head",{title:"Lista de productos"}) %>

    <body>
        <!-- Header -->
        <%- include("../partials/header") %>
        <main>
            <section class="py-5">
                <div class="container">
                  <header class="text-center mb-4">
                    <h2 class="fw-bold">Lista de Productos</h2>
                  </header>
                  <% if (products.length) { %>
                    <div class="row my-4">
                      <div class="col-12 d-flex justify-content-end">
                        <div class="d-flex align-items-center gap-3">
                          <span>Mostrar</span>
                          <form action="/productos/lista" method="GET">

                            <input type="hidden" name="page" value="<%= currentPage %>">
                            <select class="form-select form-select-md" name="limit" id="limit" onchange="this.form.submit()">
                              <option value="8" <%= limit == 8 ? 'selected' : '' %>>8</option>
                              <option value="16" <%= limit == 16 ? 'selected' : '' %>>16</option>
                              <option value="24" <%= limit == 24 ? 'selected' : '' %>>24</option>
                              <option value="48" <%= limit == 48 ? 'selected' : '' %>>48</option>
                              <option value="100" <%= limit == 100 ? 'selected' : '' %>>100</option>
                            </select>
                          </form>
                          <span>registros</span>
                        </div>
                      </div>
                    </div>
                  <% } %>
                  <div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 row-cols-lg-4 g-4">
                    <% products.forEach(product => { %>
                      <div class="col">
                        <article class="card product-card h-100">
                          <div class="position-relative">
                            <img class="card-img-top" src="/images/products/<%= product.image %>" alt="<%= product.name %>">
                            <i class="fa-regular fa-heart product-card__favorite-icon position-absolute top-0 end-0 p-2 text-danger"></i>
                          </div>
                          <div class="card-body">
                            <% const category = categories.find(cat => cat.id === product.category_id); %>
                            <p class="card-text small text-muted mb-0"><%= category ? category.categoryName : "Sin categoría" %></p>   
                            <h5 class="card-title"><%= product.name %></h5>
                            <p class="card-text fw-bold text--green"><%= converterMoneyArg(product.price) %></p>
                          </div>
                          <div class="card-footer bg-white d-flex justify-content-between gap-2 border-0">
                            <a href="/productos/detalle/<%= product.id %>" class="btn btn--secondary w-100">VER MÁS</a>
                            <button class="btn btn--primary" type="button" onclick="addProductCart('<%= product.id %>')">
                              <i class="fa-solid fa-cart-shopping"></i>
                            </button>
                          </div>
                        </article>
                      </div>
                    <% }); %>
                  </div>
                  <% if (!products.length) { %>
                    <div class="col-12 text-center py-5">
                      <h2 class="text--notFound">No hay productos que coincidan con esa búsqueda</h2>
                    </div>
                  <% } %>
                  <% if (products.length && totalPages > 1) { %>
                    <nav aria-label="Página de productos">
                      <ul class="pagination justify-content-end mt-4">
                        <% if (currentPage > 1) { %>
                          <li class="page-item">
                            <a class="page-link" href="/productos/lista?page=<%= currentPage - 1 %>&limit=<%= limit %>">Anterior</a>
                          </li>
                        <% } %>
                        <% for (let i = 1; i <= totalPages; i++) { %>
                          <li class="page-item <%= i === currentPage ? 'active' : '' %>">
                            <a class="page-link" href="/productos/lista?page=<%= i %>&limit=<%= limit %>"><%= i %></a>
                          </li>
                        <% } %>
                        <% if (currentPage < totalPages) { %>
                          <li class="page-item">
                            <a class="page-link" href="/productos/lista?page=<%= currentPage + 1 %>&limit=<%= limit %>">Siguiente</a>
                          </li>
                        <% } %>
                      </ul>
                    </nav>
                  <% } %>
                </div>
              </section>
            <!-- Section newsletter -->
            <%- include("../partials/newsletter") %>
        </main>
            <!-- Footer -->
            <%- include("../partials/footer") %>
            <!-- Scripts -->
            <%- include("../partials/scripts") %>
    </body>
</html>